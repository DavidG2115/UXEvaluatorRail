{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto p-4 dark:bg-gray-800 dark:text-gray-100">
    <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">Editar Rúbrica</h2>

    <form method="POST" id="rubricaForm">
        {% csrf_token %}
        {{ rubrica_form.as_p }}

        <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Categorías:</h3>

        <div id="categorias">
            {% for categoria in categorias %}
                <div class="categoria-item mb-4 p-4 border rounded-lg bg-gray-50 dark:bg-gray-700 shadow-sm">
                    <h4 class="font-bold text-lg mb-2 text-gray-800 dark:text-white">{{ categoria.nombre }}</h4>
                    <input type="text" name="categoria_nombre_{{ categoria.id }}" value="{{ categoria.nombre }}" placeholder="Nombre de la categoría" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-600 dark:text-white">
                    <input type="text" name="categoria_descripcion_{{ categoria.id }}" value="{{ categoria.descripcion }}" placeholder="Descripción de la categoría" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-600 dark:text-white">
                    <input type="hidden" name="eliminar_categoria_{{ categoria.id }}" value="false" class="eliminar-categoria">

                    <h5 class="font-semibold mt-2 text-gray-800 dark:text-white">Criterios:</h5>
                    <ul id="criterios-{{ categoria.id }}" class="space-y-4">
                        {% for criterio in categoria.criterios.all %}
                            <li class="bg-white dark:bg-gray-600 p-4 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <input type="text" name="criterio_nombre_{{ criterio.id }}" value="{{ criterio.nombre }}" placeholder="Nombre del criterio" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-500 dark:text-white">
                                        <input type="text" name="criterio_descripcion_{{ criterio.id }}" value="{{ criterio.descripcion }}" placeholder="Descripción del criterio" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-500 dark:text-white">
                                    </div>
                                    <button type="button" class="btn-eliminar-criterio text-red-500 hover:text-red-700" data-criterio-id="{{ criterio.id }}">
                                        Eliminar
                                    </button>
                                </div>
                                <input type="hidden" name="eliminar_criterio_{{ criterio.id }}" value="false" class="eliminar-criterio">
                                
                                <h6 class="font-semibold mt-2 text-gray-800 dark:text-white">Descripciones de Puntajes:</h6>
                                <ul class="space-y-2">
                                    {% for descripcion_puntaje in criterio.descripciones.all %}
                                        <li class="flex items-center">
                                            <strong class="mr-2 text-gray-800 dark:text-white">Puntaje {{ descripcion_puntaje.puntaje }}:</strong>
                                            <input type="text" name="descripcion_puntaje_{{ criterio.id }}_{{ descripcion_puntaje.puntaje }}" value="{{ descripcion_puntaje.descripcion }}" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% endfor %}
                    </ul>

                    <div class="flex justify-between mt-4">
                        <button type="button" class="btn-agregar-criterio bg-green-500 text-white p-2 rounded-lg hover:bg-green-600" data-categoria-id="{{ categoria.id }}">
                            Agregar Criterio
                        </button>
                        <button type="button" class="btn-eliminar-categoria bg-red-500 text-white p-2 rounded-lg hover:bg-red-600" data-categoria-id="{{ categoria.id }}">
                            Eliminar Categoría
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>

        <button type="button" id="btn-agregar-categoria" class="mt-4 p-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Agregar Categoría</button>

        <button type="submit" class="mt-4 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Guardar cambios</button>
    </form>
</div>

<script>
// Lógica para agregar/quitar criterios y categorías dinámicamente
document.addEventListener('DOMContentLoaded', function() {
    // Función para agregar un nuevo criterio dinámicamente
    document.querySelectorAll('.btn-agregar-criterio').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const categoriaId = this.getAttribute('data-categoria-id');
            const ul = document.getElementById(`criterios-${categoriaId}`);
            const newCriterio = document.createElement('li');
            newCriterio.classList.add('bg-white', 'dark:bg-gray-600', 'p-4', 'rounded-lg', 'shadow-sm', 'mt-4');
            newCriterio.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <input type="text" name="nuevo_criterio_nombre_${categoriaId}[]" placeholder="Nombre del criterio" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-500 dark:text-white">
                        <input type="text" name="nuevo_criterio_descripcion_${categoriaId}[]" placeholder="Descripción del criterio" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-500 dark:text-white">
                    </div>
                    <button type="button" class="btn-eliminar-criterio text-red-500 hover:text-red-700">Eliminar</button>
                </div>
                <h6 class="font-semibold mt-2 text-gray-800 dark:text-white">Descripciones de Puntajes:</h6>
                <ul class="space-y-2">
                    <li class="flex items-center">
                        <strong class="mr-2 text-gray-800 dark:text-white">Puntaje 1:</strong>
                        <input type="text" name="descripcion_puntaje_nuevo_${categoriaId}_1[]" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                    </li>
                    <li class="flex items-center">
                        <strong class="mr-2 text-gray-800 dark:text-white">Puntaje 2:</strong>
                        <input type="text" name="descripcion_puntaje_nuevo_${categoriaId}_2[]" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                    </li>
                    <li class="flex items-center">
                        <strong class="mr-2 text-gray-800 dark:text-white">Puntaje 3:</strong>
                        <input type="text" name="descripcion_puntaje_nuevo_${categoriaId}_3[]" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                    </li>
                    <li class="flex items-center">
                        <strong class="mr-2 text-gray-800 dark:text-white">Puntaje 4:</strong>
                        <input type="text" name="descripcion_puntaje_nuevo_${categoriaId}_4[]" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                    </li>
                    <li class="flex items-center">
                        <strong class="mr-2 text-gray-800 dark:text-white">Puntaje 5:</strong>
                        <input type="text" name="descripcion_puntaje_nuevo_${categoriaId}_5[]" placeholder="Descripción del puntaje" class="w-full p-2 border rounded-lg dark:bg-gray-500 dark:text-white">
                    </li>
                </ul>
            `;
            ul.appendChild(newCriterio);
        });
    });

    // Función para eliminar un criterio dinámicamente
    document.querySelectorAll('.btn-eliminar-criterio').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const criterioId = this.getAttribute('data-criterio-id');
            if (criterioId) {
                document.querySelector(`input[name="eliminar_criterio_${criterioId}"]`).value = 'true';
            }
            this.closest('li').style.display = 'none';
        });
    });

    // Función para agregar una nueva categoría
    document.getElementById('btn-agregar-categoria').addEventListener('click', function() {
        const categoriasDiv = document.getElementById('categorias');
        const newCategoria = document.createElement('div');
        newCategoria.classList.add('categoria-item', 'mb-4', 'p-4', 'border', 'rounded-lg', 'bg-gray-50', 'dark:bg-gray-700', 'shadow-sm');
        newCategoria.innerHTML = `
            <h4 class="font-bold text-lg mb-2 text-gray-800 dark:text-white">Nueva Categoría</h4>
            <input type="text" name="nueva_categoria_nombre[]" placeholder="Nombre de la categoría" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-600 dark:text-white">
            <input type="text" name="nueva_categoria_descripcion[]" placeholder="Descripción de la categoría" class="w-full p-2 border rounded-lg mb-2 dark:bg-gray-600 dark:text-white">
            <h5 class="font-semibold mt-2 text-gray-800 dark:text-white">Criterios:</h5>
            <ul class="space-y-4"></ul>
            <div class="flex justify-between mt-4">
                <button type="button" class="btn-agregar-criterio bg-green-500 text-white p-2 rounded-lg hover:bg-green-600">Agregar Criterio</button>
                <button type="button" class="btn-eliminar-categoria bg-red-500 text-white p-2 rounded-lg hover:bg-red-600">Eliminar Categoría</button>
            </div>
        `;
        categoriasDiv.appendChild(newCategoria);
    });

    // Función para eliminar una categoría dinámicamente
    document.querySelectorAll('.btn-eliminar-categoria').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const categoriaId = this.getAttribute('data-categoria-id');
            if (categoriaId) {
                document.querySelector(`input[name="eliminar_categoria_${categoriaId}"]`).value = 'true';
            }
            this.closest('.categoria-item').style.display = 'none';
        });
    });
});
</script>

{% endblock %}